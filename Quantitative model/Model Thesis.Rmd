---
title: "Final Model"
output: html_document
---
```{r setup, include=FALSE}
library(tidyverse)
library(readxl)

# load microdata
Romania <- read_excel("Desktop/Hertie School/Master's Thesis/Data/RO_HBS_hh.xlsx")
Bulgaria <- read_excel("Desktop/Hertie School/Master's Thesis/Data/BG_HBS_hh.xlsx")
RO_HBS_hh <- read_excel("Desktop/Hertie School/Master's Thesis/Data/RO_HBS_hh.xlsx")
BG_HBS_hh <- read_excel("Desktop/Hertie School/Master's Thesis/Data/BG_HBS_hh.xlsx")
# load regional data
ivanova <- read_excel("Desktop/regional_carbon.xlsx")
```

## R Markdown


```{r}

# Select regions from Romania and Bulgaria
Romania_regional <- ivanova%>% subset(rcode=="RO11" | rcode=="RO41"|rcode=="RO42" | rcode=="RO31" |rcode=="RO32" | rcode=="RO22" |rcode=="RO12" | rcode=="RO21")

Bulgaria_regional <-ivanova %>% subset(rcode=="BG31" | rcode=="BG32" | rcode=="BG33"| rcode=="BG34" |rcode=="BG41" |rcode=="BG42")

# Get rid of useless variables
Romania_regional <- Romania_regional %>% subset(select = -c(rname,syear,nutslevel,hcf_kg,inc_cap_1000,inc_cap_1000_2,urban,teduc_30,basic,hdd_m, forest_m2cap_1000,emix_cat,nrooms,hcf_1d:hcf_14i))

Bulgaria_regional <- Bulgaria_regional %>% subset(select = -c(rname,syear,nutslevel,hcf_kg,inc_cap_1000,inc_cap_1000_2,urban,teduc_30,basic,hdd_m, forest_m2cap_1000,emix_cat,nrooms,hcf_1d:hcf_14i))

# Get the household size for every region
hhsize_Romania <- Romania_regional$hhsize
hhsize_Bulgaria <- Bulgaria_regional$hhsize


# Stor regional codes in both countries
rcode_Romania<- Romania_regional$rcode
rcode_Bulgaria<- Bulgaria_regional$rcode

# Shift from dataframe to matrix, easier to work with numeric values
Romania_regional <- as.matrix(Romania_regional %>% subset(select = -c(hhsize,rcode)))
Bulgaria_regional <- as.matrix(Bulgaria_regional %>% subset(select = -c(hhsize,rcode)))

storage.mode(Romania_regional) <- "numeric"
storage.mode(hhsize_Romania ) <- "numeric"
storage.mode(Bulgaria_regional) <- "numeric"
storage.mode(hhsize_Bulgaria ) <- "numeric"


# Switch to regional household averages for Romania
Romania_regional[1,] <- Romania_regional[1,] * hhsize_Romania[1]
Romania_regional[2,] <- Romania_regional[2,] * hhsize_Romania[2]
Romania_regional[3,] <- Romania_regional[3,] * hhsize_Romania[3]
Romania_regional[4,] <- Romania_regional[4,] * hhsize_Romania[4]
Romania_regional[5,] <- Romania_regional[5,] * hhsize_Romania[5]
Romania_regional[6,] <- Romania_regional[6,] * hhsize_Romania[6]
Romania_regional[7,] <- Romania_regional[7,] * hhsize_Romania[7]
Romania_regional[8,] <- Romania_regional[8,] * hhsize_Romania[8]

# Switch to regional household averages for Bulgaria

Bulgaria_regional[1,] <- Bulgaria_regional[1,] * hhsize_Bulgaria [1]
Bulgaria_regional[2,] <- Bulgaria_regional[2,] * hhsize_Bulgaria [2]
Bulgaria_regional[3,] <- Bulgaria_regional[3,] * hhsize_Bulgaria [3]
Bulgaria_regional[4,] <- Bulgaria_regional[4,] * hhsize_Bulgaria [4]
Bulgaria_regional[5,] <- Bulgaria_regional[5,] * hhsize_Bulgaria [5]
Bulgaria_regional[6,] <- Bulgaria_regional[6,] * hhsize_Bulgaria [6]

Romania_regional <- as.data.frame(Romania_regional)
Bulgaria_regional <- as.data.frame(Bulgaria_regional)

Romania_regional$region <-rcode_Romania
Bulgaria_regional$region <-rcode_Bulgaria

Romania_regional<- Romania_regional %>% subset(select= c(region,hcf_1:hcf_14))
Romania_regional<- rename(Romania_regional,food_animal=hcf_1, food_plant=hcf_2, food_nec=hcf_3, clothing=hcf_4, mobility_vehicles=hcf_5, mobility_fuel=hcf_6,  mobility_services= hcf_7, services=hcf_8, manufacture_products=hcf_9, manufacture_shelter=hcf_10, shelter_rent=hcf_11, shelter_electricity_fuels=hcf_12,shelter_construction=hcf_13, shelter_waste=hcf_14)

Bulgaria_regional <- Bulgaria_regional%>% subset(select= c(region,hcf_1:hcf_14))
Bulgaria_regional <- rename(Bulgaria_regional,food_animal=hcf_1, food_plant=hcf_2, food_nec=hcf_3, clothing=hcf_4, mobility_vehicles=hcf_5, mobility_fuel=hcf_6,  mobility_services= hcf_7, services=hcf_8, manufacture_products=hcf_9, manufacture_shelter=hcf_10, shelter_rent=hcf_11, shelter_electricity_fuels=hcf_12,shelter_construction=hcf_13, shelter_waste=hcf_14)


RO4_avg <- 0.20*Romania_regional[1,2:15] + 0.80*Romania_regional[2,2:15]
RO3_avg <- 0.55*Romania_regional[3,2:15] + 0.45*Romania_regional[5,2:15]
RO1_avg <- 0.50*Romania_regional[4,2:15] + 0.50*Romania_regional[7,2:15]
RO2_avg <- 0.90*Romania_regional[6,2:15] + 0.10*Romania_regional[8,2:15]


BG3_avg <- 0.25*Bulgaria_regional[1,2:15] + 0.25*Bulgaria_regional[2,2:15] + 0.25*Bulgaria_regional[5,2:15] + 0.25*Bulgaria_regional[6,2:15]
BG4_avg <- 0.40*Bulgaria_regional[3,2:15] + 0.60*Bulgaria_regional[4,2:15]

#Create transposes to capture the structure of the matrix

RO4_t <- as.vector(t(as.matrix(RO4_avg)))
RO3_t <- as.vector(t(as.matrix(RO3_avg)))
RO2_t <- as.vector(t(as.matrix(RO2_avg)))
RO1_t <- as.vector(t(as.matrix(RO1_avg)))
BG4_t <- as.vector(t(as.matrix(BG4_avg)))
BG3_t <- as.vector(t(as.matrix(BG3_avg)))

```





## Including Plots



```{r pressure, echo=FALSE}


Romania$food_animal= Romania$EUR_HE0112+Romania$EUR_HE0113+Romania$EUR_HE0114+ Romania$EUR_HE01151 + Romania$EUR_HE01155 
Romania$food_plant= Romania$EUR_HE0111 + Romania$EUR_HE01152 + Romania$EUR_HE01153+Romania$EUR_HE01154 + Romania$EUR_HE0116 +Romania$EUR_HE0117 + Romania$EUR_HE0118
Romania$food_nec= Romania$EUR_HE0119
Romania$clothing = Romania$EUR_HE03 
Romania$mobility_vehicles=Romania$EUR_HE071 + Romania$EUR_HE0712 + Romania$EUR_HE0713 + Romania $EUR_HE0714
Romania$mobility_fuel= Romania$EUR_HE0722 
Romania$mobility_services= Romania$EUR_HE073
Romania$services=Romania$EUR_HE08+ Romania$EUR_HE09 + Romania$EUR_HE10+ Romania$EUR_HE11+Romania$EUR_HE12
Romania$manufacture_products= Romania$EUR_HE053 
Romania$manufacture_shelter= Romania$EUR_HE052 + Romania$EUR_HE051+Romania$EUR_HE054+Romania$EUR_HE055+ Romania$EUR_HE056
Romania$shelter_rent= Romania$EUR_HE041 
Romania$shelter_electricity_fuels=Romania$EUR_HE045
Romania$construction=Romania$EUR_HE043
Romania$shelter_waste=Romania$EUR_HE0443 +Romania$EUR_HE0444+Romania$EUR_HE0442
Romania$id=Romania$HA04
Romania$region=Romania$NUTS1

Bulgaria$food_animal= Bulgaria$EUR_HE0112+Bulgaria$EUR_HE0113+Bulgaria$EUR_HE0114+ Bulgaria$EUR_HE01151 + Bulgaria$EUR_HE01155 
Bulgaria$food_plant= Bulgaria$EUR_HE0111 + Bulgaria$EUR_HE01152 + Bulgaria$EUR_HE01153+Bulgaria$EUR_HE01154 + Bulgaria$EUR_HE0116 +Bulgaria$EUR_HE0117 + Bulgaria$EUR_HE0118
Bulgaria$food_nec= Bulgaria$EUR_HE0119
Bulgaria$clothing = Bulgaria$EUR_HE03 
Bulgaria$mobility_vehicles=Bulgaria$EUR_HE071 + Bulgaria$EUR_HE0712 + Bulgaria$EUR_HE0713 + Bulgaria $EUR_HE0714
Bulgaria$mobility_fuel= Bulgaria$EUR_HE0722 
Bulgaria$mobility_services= Bulgaria$EUR_HE073
Bulgaria$services=Bulgaria$EUR_HE08+ Bulgaria$EUR_HE09 + Bulgaria$EUR_HE10+ Bulgaria$EUR_HE11+Bulgaria$EUR_HE12
Bulgaria$manufacture_products= Bulgaria$EUR_HE053 
Bulgaria$manufacture_shelter= Bulgaria$EUR_HE052 + Bulgaria$EUR_HE051+Bulgaria$EUR_HE054+Bulgaria$EUR_HE055+ Bulgaria$EUR_HE056
Bulgaria$shelter_rent= Bulgaria$EUR_HE041 
Bulgaria$shelter_electricity_fuels=Bulgaria$EUR_HE045
Bulgaria$construction=Bulgaria$EUR_HE043
Bulgaria$shelter_waste=Bulgaria$EUR_HE0443 +Bulgaria$EUR_HE0444+Bulgaria$EUR_HE0442
Bulgaria$id=Bulgaria$HA04
Bulgaria$region=Bulgaria$NUTS1



# select necessary variables
Romania <- Romania %>% subset(select=c(id,region,food_animal, food_plant,food_nec,clothing, mobility_vehicles, mobility_fuel, mobility_services,services,manufacture_products,manufacture_shelter,shelter_rent, shelter_electricity_fuels, construction, shelter_waste))

Bulgaria <- Bulgaria %>% subset(select=c(id,region,food_animal, food_plant,food_nec,clothing, mobility_vehicles, mobility_fuel, mobility_services,services,manufacture_products,manufacture_shelter,shelter_rent, shelter_electricity_fuels, construction, shelter_waste))


# create regional datasets (expenditures)
Romania_1 <-Romania %>% subset(region=="RO1") 
Romania_2 <-Romania %>% subset(region=="RO2") 
Romania_3 <-Romania %>% subset(region=="RO3")
Romania_4 <-Romania %>% subset(region=="RO4")

Bulgaria_3 <-Bulgaria %>% subset(region=="BG3") 
Bulgaria_4 <-Bulgaria %>% subset(region=="BG4") 


#save the id and region
Romania_hh1 <- Romania_1 %>% select(id,region)
Romania_hh2 <- Romania_2 %>% select(id,region)
Romania_hh3 <- Romania_3 %>% select(id,region)
Romania_hh4 <- Romania_4 %>% select(id,region)

Bulgaria_hh3 <- Bulgaria_3 %>% select(id,region)
Bulgaria_hh4 <- Bulgaria_4%>% select(id,region)


#create means and sd for the regional datasets (expenditures)

ROsd1 <-Romania_1 %>% select(3:16) %>% sapply(function(x)sd(x)/sqrt(length(x)))
ROsd2 <-Romania_2 %>% select(3:16) %>% sapply(function(x)sd(x)/sqrt(length(x)))
ROsd3 <-Romania_3 %>% select(3:16) %>% sapply(function(x)sd(x)/sqrt(length(x)))
ROsd4 <-Romania_4 %>% select(3:16) %>% sapply(function(x)sd(x)/sqrt(length(x)))

BGsd3 <-Bulgaria_3 %>% select(3:16) %>% sapply(function(x)sd(x)/sqrt(length(x)))
BGsd4 <-Bulgaria_4 %>% select(3:16) %>% sapply(function(x)sd(x)/sqrt(length(x)))

# scale the regional data (expenditures)
Romania_1 <- Romania_1 %>% select(3:16) %>% scale 
Romania_2 <- Romania_2 %>% select(3:16) %>% scale 
Romania_3 <- Romania_3 %>% select(3:16) %>% scale 
Romania_4 <- Romania_4 %>% select(3:16) %>% scale 
Bulgaria_3 <- Bulgaria_3 %>% select(3:16) %>% scale 
Bulgaria_4 <- Bulgaria_4 %>% select(3:16) %>% scale 


# use carbon averages(RO1_Avg) and rescale the expenditure data( Romania_1)
Romania_carbon_hh1 <- Romania_1*ROsd1[col(RO1_avg)] + RO1_t[col(RO1_avg)] 
Romania_carbon_hh2 <- Romania_2*ROsd2[col(RO2_avg)] + RO2_t[col(RO2_avg)] 
Romania_carbon_hh3 <- Romania_3 *ROsd3[col(RO3_avg )] + RO3_t[col(RO3_avg)] 
Romania_carbon_hh4 <- Romania_4 *ROsd4[col(RO4_avg )] + RO3_t[col(RO4_avg )] 

Bulgaria_carbon_hh3 <- Bulgaria_3 *BGsd3[col(BG3_avg )] + BG3_t[col(BG3_avg)] 
Bulgaria_carbon_hh4 <- Bulgaria_4 *BGsd4[col(BG4_avg )] + BG3_t[col(BG4_avg )] 


#get complete data

Romania_carbon1 <-cbind(Romania_hh1, Romania_carbon_hh1)
Romania_carbon2 <-cbind(Romania_hh2, Romania_carbon_hh2)
Romania_carbon3 <-cbind(Romania_hh3, Romania_carbon_hh3)
Romania_carbon4 <-cbind(Romania_hh4, Romania_carbon_hh4)

Bulgaria_carbon3 <-cbind(Bulgaria_hh3,Bulgaria_carbon_hh3)
Bulgaria_carbon4 <-cbind(Bulgaria_hh4,Bulgaria_carbon_hh4)

Romania_carbon12 <-rbind(Romania_carbon1,Romania_carbon2)
Romania_carbon34 <-rbind(Romania_carbon3,Romania_carbon4)

Romania_carbon <-rbind(Romania_carbon12,Romania_carbon34)

Bulgaria_carbon <-rbind(Bulgaria_carbon3,Bulgaria_carbon4)

# Gather aditional data on household size and net income

Bulgaria_data <- BG_HBS_hh %>% select(id=HA04, income=EUR_HH099,size=HB05)
Romania_data <-  RO_HBS_hh %>% select(id=HA04, income=EUR_HH099, size=HB05)

#Create the final datasets for households
Romania_carbon <-merge(Romania_carbon,Romania_data,by="id")
Bulgaria_carbon <-merge(Bulgaria_carbon,Bulgaria_data,by="id")

#Create the final datasets per capita

Romania_carbon[,3:16] <- Romania_carbon[,3:16]/ Romania_carbon$size
Bulgaria_carbon[,3:16] <-Bulgaria_carbon[,3:16]/Bulgaria_carbon$size



# Create datasets per ton of CO2 not kg of CO2
Romania_carbon[,3:16] <- Romania_carbon[,3:16]/ 1000
Bulgaria_carbon[,3:16] <-Bulgaria_carbon[,3:16]/1000

# Add income deciles 

Romania_carbon$decile <- ntile(Romania_carbon$income, 10)  
Bulgaria_carbon$decile <- ntile(Bulgaria_carbon$income, 10)

Romania_carbon$sum = rowSums(Romania_carbon[ , c(3:16)], na.rm = T)
Bulgaria_carbon$sum =rowSums(Bulgaria_carbon[,c(3:16)], na.rm=T)


# Factorization

Romania_mean2010 <- 3.52
Bulgaria_mean2010 <- 6.34

Romania_imputedmean2010<-mean(Romania_carbon$sum)
Bulgaria_imputedmean2010<-mean(Bulgaria_carbon$sum)

Romania_factor <- Romania_imputedmean2010 / Romania_mean2010
Bulgaria_factor <- Bulgaria_imputedmean2010 / Bulgaria_mean2010

Romania_carbon[,3:16] <- Romania_carbon[,3:16]/ Romania_factor
Bulgaria_carbon[,3:16] <-Bulgaria_carbon[,3:16]/Bulgaria_factor


Romania_carbon$sum = rowSums(Romania_carbon[ , c(3:16)], na.rm = T)
Bulgaria_carbon$sum =rowSums(Bulgaria_carbon[,c(3:16)], na.rm=T)

#export datasets

write_xlsx(Romania_carbon,"/Users/vladsurdea/Desktop/RO.xlsx")
write_xlsx(Bulgaria_carbon,"/Users/vladsurdea/Desktop/BG.xlsx")
```



```{r}
RO <- read_excel("/Users/vladsurdea/Desktop/RO.xlsx")
BG <- read_excel("/Users/vladsurdea/Desktop/BG.xlsx")
t1=12
t2=34

RO$tax1 = RO$sum *t1
RO$tax2 = RO$sum *t2
BG$tax1 = BG$sum *t1
BG$tax2 = BG$sum *t2

revenue_RO_tax1 <-sum(RO$tax1)
revenue_BG_tax1 <-sum(BG$tax1)
revenue_BG_tax2 <-sum(BG$tax2)

RO$share_tax1 = (RO$tax1 *100)/RO$income
RO$share_tax2 = (RO$tax2 *100)/RO$income
BG$share_tax1 = (BG$tax1 *100)/BG$income
BG$share_tax2 = (BG$tax2 *100)/BG$income

RO_average=as.data.frame(colMeans(RO[ , c(3:16)], na.rm = T))
RO$RO_average=mean(RO$sum) 
RO_tax_average=RO_average *t1
RO$delta1 <- RO$sum-RO$RO_average
RO$indicator1 <- 1+ RO$delta1/RO$RO_average

BG_average=as.data.frame(colMeans(BG[ , c(3:16)], na.rm = T))
BG$BG_average=mean(BG$sum) 
BG_tax_average=BG_average *t1
BG$delta1 <- BG$sum-BG$BG_average
BG$indicator1 <- 1+ BG$delta1/BG$BG_average


RO$decile <- ntile(RO$income, 10)  

BG$decile <-ntile(BG$income, 10)

RO_deciles <- RO %>% group_by(decile) %>%
  summarize(mean_tax1=mean(share_tax1), mean_tax2=mean(share_tax2))

BG_deciles <- BG %>% group_by(decile) %>%
  summarize(mean_tax1=mean(share_tax1), mean_tax2=mean(share_tax2))

labeltax1 <-"\u20AC12/tCO_2"
labeltax2 <-"\u20AC34/tCO[2]"

ggplot(RO_deciles, aes(x=decile))+
  geom_line(aes(y=mean_tax1),color="indianred2", size=1.2, linetype="solid")+
  geom_line(aes(y=mean_tax2),color="deepskyblue3",size=1.2, linetype="solid")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  scale_y_continuous(breaks=c(0,2.5,5,7.5,10,12,15))+
  xlab("Income deciles")+
  ylab ("Mean income share of the carbon tax (%)")+
  theme_stata()+
  annotate("label", size=5, x = 4.15, y=1.82,label=TeX(" €12/tCO_2"),fill="indianred2",color="white", parse=TRUE)+
  annotate("label",size=5,  x = 4.15, y=4.47,label=TeX(" €34/tCO_2"), fill="deepskyblue3",color="white")+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))+
  coord_cartesian(expand = FALSE)

ggplot(subset(BG_deciles,mean_tax2<20), aes(x=decile))+
  geom_line(aes(y=mean_tax1),color="indianred2", size=1.2, linetype="solid")+
  geom_line(aes(y=mean_tax2),color="deepskyblue3",size=1.2, linetype="solid")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  scale_y_continuous(breaks=c(0,2.5,5,7.5,10,12,15))+
  xlab("Income deciles")+
  ylab ("Mean income share of the carbon tax (%)")+
  theme_stata()+
  annotate("label", size=5,x = 4.15, y=1.82,label=TeX(" €12/tCO_2"),fill="indianred2",color="white", parse=TRUE)+
  annotate("label", size=5, x = 4.15, y=10.47,label=TeX(" €34/tCO_2"), fill="deepskyblue3",color="white")+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=14), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))+
  coord_cartesian(expand = FALSE)

#################INDICATOR

RO_deciles <- RO %>% group_by(decile) %>%
  summarize(mean_tax1=mean(share_tax1), mean_tax2=mean(share_tax2))

RO_indicators <- RO %>% group_by(decile) %>%
  summarize(mean_indicator=mean(indicator1))

ggplot(RO_indicators, aes(x=decile))+
  geom_line(aes(y=mean_indicator),color="indianred2",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("Regresivity indicator")+
    theme_stata()+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))+
  coord_cartesian(expand = FALSE)

BG_indicators <- BG %>% group_by(decile) %>%
  summarize(mean_indicator=mean(indicator1))


ggplot(BG_indicators, aes(x=decile))+
  geom_line(aes(y=mean_indicator),color="indianred2",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("Regresivity indicator")+
    theme_stata()+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))+
  coord_cartesian(expand = FALSE)

RO_deciles$indicator <-RO_indicators$mean_indicator

RO_deciles %>%
  kbl(col.names = c("Income decile",
                           "Mean income share of tax1",
                           "Mean income share of tax2",
                          "Mean regressivity indicator")) %>%
  kable_classic_2(full_width = F)


BG_deciles$indicator <-BG_indicators$mean_indicator
BG_deciles %>%
  kbl(col.names = c("Income decile",
                           "Mean income share of tax1",
                           "Mean income share of tax2",
                          "Mean regressivity indicator")) %>%
  kable_classic_2(full_width = F)



RO_indicators %>%
  kbl(col.names = c("Income decile",
                           "Mean regressivity indicator")) %>%
  kable_classic_2(full_width = F)


RO_regions <- RO %>% group_by(region) %>%
  summarize(mean_tax1=mean(share_tax1), mean_tax2=mean(share_tax2), mean_regressivity=mean(indicator1))

p1 <- ggplot(RO, aes(x=region))+
  geom_boxplot(fill="indianred2",aes(y=share_tax1))+
  scale_y_continuous(limits=c(0,0.5,1,1.5))+
  theme_stata()+
     theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))+
  xlab("Income decile")+
  ylab ("Share of annual consumption expenditure  (%)")

p2 <- ggplot(RO, aes(x=region))+
  geom_boxplot(fill="deepskyblue3",aes(y=share_tax2))+
  scale_y_continuous(limits=c(0,0.5,1,1.5))+
  theme_stata()+
     theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))+
  xlab("Income decile")+
  ylab ("Share of annual consumption expenditure (%)")


figure <- ggarrange(p1, p2,
                    ncol = 2, nrow = 1)


BG_regions <- BG %>% group_by(region) %>%
  summarize(mean_tax1=mean(share_tax1), mean_tax2=mean(share_tax2), mean_regressivity=mean(indicator1))

r1 <- ggplot(BG, aes(x=region))+
  geom_boxplot(fill="indianred2",aes(y=share_tax1))+
  scale_y_continuous(limits=c(0,0.5,1,1.5))+
  theme_stata()+
     theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))+
  xlab("Income decile")+
  ylab ("Share of annual consumption expenditure  (%)")

r2 <- ggplot(BG, aes(x=region))+
  geom_boxplot(fill="deepskyblue3",aes(y=share_tax2))+
  scale_y_continuous(limits=c(0,0.5,1,1.5))+
  theme_stata()+
     theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.05), axis.line = element_line(color="black"))+
  xlab("Income decile")+
  ylab ("Share of annual consumption expenditure (%)")

r3 <- ggplot(BG, aes(x=region))+
  geom_boxplot(fill="lightpink3",aes(y=indicator1))+
  theme_calc()+
     theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=10), axis.text.y=element_text(size=10), axis.title.y.left = element_text(size=12), axis.title.x.bottom = element_text(size=12))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
  theme(panel.background = element_rect(fill="cornsilk"))+
  xlab("Income decile")+
  ylab ("Regresivity indicator")

figureBG <- ggarrange(r1, r2,
                    ncol = 2, nrow = 1)

######################################33

RO2 <- RO %>% group_by(decile) %>%
summarize(food=mean(food_animal+food_nec+food_plant), shelter=mean(shelter_waste+shelter_electricity_fuels+shelter_rent+construction), manufacture=mean(manufacture_shelter+manufacture_products),clothing=mean(clothing), mobility=mean(mobility_services+mobility_fuel+mobility_vehicles), services=mean(services))


ROfood<-ggplot(RO2, aes(y=food,x=decile)) +
geom_segment(aes(y = 0, x = decile, yend = food, xend = decile), color = "indianred2",size=1.5) +
geom_point(size=2.5,color="indianred2")+
scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,9,10))+
 scale_y_continuous(expand = c(0,0))+
  xlab("Income deciles")+
  ylab ("Food as share of annual income(%)")+
  theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))

ROshelter<-ggplot(RO2, aes(y=shelter,x=decile)) +
geom_segment(aes(y = 0, x = decile, yend = food, xend = decile), color = "indianred2",size=1.5) +
geom_point(size=2.5,color="indianred2")+
scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,9,10))+
 scale_y_continuous(expand = c(0,0))+
  xlab("Income deciles")+
  ylab ("Shelter as share of annual income (%)")+
theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))


ROmobility<-ggplot(RO2, aes(y=mobility,x=decile)) +
geom_segment(aes(y = 0, x = decile, yend = food, xend = decile), color = "indianred2",size=1.5) +
geom_point(size=2.5,color="indianred2")+
scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,9,10))+
 scale_y_continuous(expand = c(0,0))+
  xlab("Income deciles")+
  ylab ("Transport as share of annual income (%)")+
theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))

ROservices<-ggplot(RO2, aes(y=services,x=decile)) +
geom_segment(aes(x = decile, y = 0, yend = food, xend = decile), color = "indianred2",size=1.5) +
geom_point(size=2.5,color="indianred2")+
scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,9,10))+
 scale_y_continuous(expand = c(0,0))+
   xlab("Income deciles")+
  ylab ("Services as share of annual income (%)")+
theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))

figure2 <- ggarrange(ROfood,ROmobility,ROservices,ROshelter,
                    ncol = 2, nrow = 2)


BG2 <- BG %>% group_by(decile) %>%
summarize(food=mean(food_animal+food_nec+food_plant), shelter=mean(shelter_waste+shelter_electricity_fuels+shelter_rent+construction), manufacture=mean(manufacture_shelter+manufacture_products),clothing=mean(clothing), mobility=mean(mobility_services+mobility_fuel+mobility_vehicles), services=mean(services))


BGfood<-ggplot(BG2, aes(y=food,x=decile)) +
geom_segment(aes(y = 0, x = decile, yend = food, xend = decile), color = "indianred2",size=1.5) +
geom_point(size=2.5,color="indianred2")+
scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,9,10))+
 scale_y_continuous(expand = c(0,0))+
  xlab("Income deciles")+
  ylab ("Food as share of annual income (%)")+
theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))

BGshelter<-ggplot(BG2, aes(y=shelter,x=decile)) +
geom_segment(aes(y = 0, x = decile, yend = food, xend = decile), color = "indianred2",size=1.5) +
geom_point(size=2.5,color="indianred2")+
scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,9,10))+
 scale_y_continuous(expand = c(0,0))+
  xlab("Income deciles")+
  ylab ("Shelter as share of annual income (%)")+
theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))


BGmobility<-ggplot(BG2, aes(y=mobility,x=decile)) +
geom_segment(aes(y = 0, x = decile, yend = food, xend = decile), color = "indianred2",size=1.5) +
geom_point(size=2.5,color="indianred2")+
scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,9,10))+
 scale_y_continuous(expand = c(0,0))+
  xlab("Income deciles")+
  ylab ("Transport as share of annual income (%)")+
theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))


BGservices<-ggplot(BG2, aes(y=services,x=decile)) +
geom_segment(aes(y = 0, x = decile, yend = food, xend = decile), color = "indianred2",size=1.5) +
geom_point(size=2.5,color="indianred2")+
scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,9,10))+
 scale_y_continuous(expand = c(0,0))+
  xlab("Income deciles")+
  ylab ("Services as share of annual income (%) (%)")+
theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.05), axis.line = element_line(color="black"))

figure2BG <- ggarrange(BGfood,BGmobility,BGservices,BGshelter,
                    ncol = 2, nrow = 2)



######################################33
BG$decile <- ntile(BG$income, 10)  

BG_deciles <- BG %>% group_by(decile) %>%
  summarize(mean_tax1=mean(share_tax1), mean_tax2=mean(share_tax2))

ggplot(BG_deciles, aes(x=decile))+
  geom_line(aes(y=mean_tax1),color="darkred")+
  geom_line(aes(y=mean_tax2),color="steelblue")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("Average income share of the carbon tax (%)")+
  theme_minimal()

BG$BG_average=mean(BG$sum) 
BG$delta1 <- BG$sum-BG$BG_average
BG$indicator1 <- 1+ BG$delta1/BG$BG_average

BG_indicators <- BG %>% group_by(decile) %>%
  summarize(mean_indicator=mean(indicator1))

ggplot(BG_indicators, aes(x=decile))+
  geom_line(aes(y=mean_indicator),color="darkred")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("Regresivity indicator")+
  theme_minimal()


#######################################################

RO_regions <- RO %>% group_by(region) %>%
  summarize(mean_tax1=mean(share_tax1), mean_tax2=mean(share_tax2))

ggplot(RO_regions, aes(x=region))+
  geom_point(aes(y=mean_tax1),color="darkred")+
  geom_point(aes(y=mean_tax2),color="steelblue")+
  xlab("Income decile")+
  ylab ("Average income share of the carbon tax (%)")+
  theme_minimal()



BG_regions <- BG %>% group_by(region) %>%
  summarize(mean_tax1=mean(share_tax1), mean_tax2=mean(share_tax2))

ggplot(BG_regions, aes(x=region))+
  geom_point(aes(y=mean_tax1),color="darkred")+
  geom_point(aes(y=mean_tax2),color="steelblue")+
  xlab("Income decile")+
  ylab ("Average income share of the carbon tax (%)")+
  theme_minimal()

#####################################################################################################################################################################################################################################################################################################################################################################
RO$lump_tax1 <- revenue_RO_tax1/ 31336
RO$lump_tax2 <- revenue_RO_tax2/ 31336

BG$lump_tax1 <- revenue_BG_tax1/ 2982
BG$lump_tax2 <- revenue_BG_tax2/ 2982

RO$after_lump1 <-RO$tax1-RO$lump_tax1
RO$after_lump2 <-RO$tax2-RO$lump_tax2

BG$after_lump1 <-BG$tax1-BG$lump_tax1
BG$after_lump2 <-BG$tax2-BG$lump_tax2

RO$share_lumptax1 = (RO$after_lump1 *100)/RO$income
RO$share_lumptax2 = (RO$after_lump2 *100)/RO$income

BG$share_lumptax1 = (BG$after_lump1 *100)/BG$income
BG$share_lumptax2 = (BG$after_lump2 *100)/BG$income

RO_deciles2 <- RO %>% group_by(decile) %>%
  summarize(mean_lumptax1=mean(share_lumptax1), mean_lumptax2=mean(share_lumptax2))

BG_deciles2 <- BG %>% group_by(decile) %>%
  summarize(mean_lumptax1=mean(share_lumptax1), mean_lumptax2=mean(share_lumptax2))

l12<-ggplot(RO_deciles2, aes(x=decile))+
  geom_line(aes(y=mean_lumptax1),color="indianred2",size=1.2)+
  geom_line(aes(y=mean_lumptax2),color="deepskyblue3",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("Average income share of the carbon tax (%)")+
  theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
   annotate("label", size=5, x = 4.15, y=-0.3,label=TeX(" €12/tCO_2"),fill="indianred2",color="white", parse=TRUE)+
  annotate("label", size=5, x = 4.15, y=1,label=TeX(" €34/tCO_2"), fill="deepskyblue3",color="white")
  
r12<-ggplot(BG_deciles2, aes(x=decile))+
  geom_line(aes(y=mean_lumptax1),color="indianred2",size=1.2)+
  geom_line(aes(y=mean_lumptax2),color="deepskyblue3",size=1.2)+
  
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("Average income share of the carbon tax (%)")+
  theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
   annotate("label", size=5,x = 4.15, y=-0.6,label=TeX(" €12/tCO_2"),fill="indianred2",color="white", parse=TRUE)+
  annotate("label",size=5, x = 5.15, y=1,label=TeX(" €34/tCO_2"), fill="deepskyblue3",color="white")

sum(RO$indicator1 >1)

RO$revenueRawls <-ifelse(RO$indicator1>1, revenue_RO_tax1/11223,0)
RO$afterRawls <-RO$tax1-RO$revenueRawls

BG$revenueRawls <-ifelse(BG$indicator1>1, revenue_BG_tax1/875,0)
BG$afterRawls <-BG$tax1-BG$revenueRawls


RO$share_afterRawls= (RO$afterRawls *100)/RO$income
BG$share_afterRawls= (BG$afterRawls *100)/BG$income

RORawls <-RO%>%group_by(decile) %>%
  summarize(Rawls=mean(share_afterRawls))

BGRawls <-BG%>%group_by(decile) %>%
  summarize(Rawls=mean(share_afterRawls))


shareRawls <- ggplot(RORawls, aes(x=decile))+
  geom_line(aes(y=Rawls),color="indianred2",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("Average income share of the carbon tax (%)")+
  theme_calc()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=12), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=14), axis.title.x.bottom = element_text(size=14))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="cornsilk"))

  ggplot(RO_Rawls_deciles, aes(x=mean_income,y=mean_after))+
  geom_point(aes(group=decile),color="indianred2",size=3)+
  xlab("Income decile")+
  ylab ("Average income share of the carbon tax (%)")+
  theme_calc()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=12), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=14), axis.title.x.bottom = element_text(size=14))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="cornsilk"))


RO_Rawls_deciles <- RO %>% group_by(decile) %>%
  summarize(mean_Rawls=mean(share_afterRawls), l1=mean(after_lump1),l2=mean(after_lump2), r1=mean(afterRawls),r2=mean(afterRawls2))

BG_Rawls_deciles <- BG %>% group_by(decile) %>%
  summarize(mean_Rawls=mean(share_afterRawls), l1=mean(after_lump1),l2=mean(after_lump2), r1=mean(afterRawls),r2=mean(afterRawls2))

 l34<-ggplot(RO_Rawls_deciles, aes(x=decile))+
  geom_line(aes(y=l1),color="indianred2",size=1.6)+
  geom_line(aes(y=l2),color="deepskyblue3",size=1.6)+
  xlab("Income decile")+
  ylab ("Tax value (€)")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  scale_y_continuous(breaks=c(-45,-30,-15,0,15,30,45,60))+
  theme_calc()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=12), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=14), axis.title.x.bottom = element_text(size=14))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="cornsilk"))+
   annotate("label", x = 2.15, y=1.82,label=TeX(" €12/tCO_2"),fill="indianred2",color="white", parse=TRUE)+
  annotate("label", x = 3.15, y=42,label=TeX(" €34/tCO_2"), fill="deepskyblue3",color="white",parse=TRUE)

r34<-ggplot(BG_Rawls_deciles, aes(x=decile))+
  geom_line(aes(y=r1),color="indianred2",size=1.6)+
  geom_line(aes(y=r2),color="deepskyblue3",size=1.6)+
  xlab("Income decile")+
  ylab ("Tax value (€)")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  scale_y_continuous(breaks=c(-45,-30,-15,0,15,30,45,60))+
  theme_calc()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=12), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=14), axis.title.x.bottom = element_text(size=14))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="cornsilk"))+
   annotate("label", x = 3.55, y=1.82,label=TeX(" €12/tCO_2"),fill="indianred2",color="white", parse=TRUE)+
  annotate("label", x = 7.15, y=42,label=TeX(" €34/tCO_2"), fill="deepskyblue3",color="white",parse=TRUE)

moneyrawls<-ggplot(RO_Rawls_deciles, aes(x=decile))+
  geom_line(aes(y=r1),color="indianred2",size=1.6)+
  xlab("Income decile")+
  ylab ("Tax value (€)")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  scale_y_continuous(breaks=c(-45,-30,-15,0,15,30,45,60))+
  theme_calc()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=12), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=14), axis.title.x.bottom = element_text(size=14))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="cornsilk"))

figure3 <- ggarrange(shareRawls,moneyrawls,
                    ncol = 2, nrow = 1)

figure4 <- ggarrange(l12,l34,
                    ncol = 2, nrow = 1)


figure4BG <- ggarrange(r12,r34,
                    ncol = 2, nrow = 1)



######################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

RO$revenueRawls2<-ifelse(RO$indicator1>1, revenue_RO_tax2/11223,0)
RO$afterRawls2 <-RO$tax2-RO$revenueRawls2

BG$revenueRawls2<-ifelse(BG$indicator1>1, revenue_BG_tax2/875,0)
BG$afterRawls2 <-BG$tax2-BG$revenueRawls2


RO$share_afterRawls2= (RO$afterRawls2 *100)/RO$income
BG$share_afterRawls2= (BG$afterRawls2 *100)/BG$income


RORawls2 <-RO%>%group_by(decile) %>%
  summarize(Rawls2=mean(share_afterRawls2))

BGRawls2 <-BG%>%group_by(decile) %>%
  summarize(Rawls2=mean(share_afterRawls2))


shareRawls <- ggplot(RORawls, aes(x=decile))+
  geom_line(aes(y=Rawls),color="indianred2",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("EUR 12 tax as share of income (%)")+
  theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))


shareRawls2 <- ggplot(RORawls2, aes(x=decile))+
  geom_line(aes(y=Rawls2),color="deepskyblue3",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab (" EUR 34 tax as share of income(%)")+
  theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))

figR <- ggarrange(shareRawls,shareRawls2,
                    ncol = 1, nrow = 2)


moneyrawls2<-ggplot(RO_Rawls_deciles, aes(x=decile))+
  geom_line(aes(y=r2),color="deepskyblue3",size=1.6)+
  xlab("Income decile")+
  ylab ("Tax value (€)")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  scale_y_continuous(breaks=c(-45,-30,-15,0,15,30,45,60))+
  theme_calc()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=12), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=14), axis.title.x.bottom = element_text(size=14))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="cornsilk"))

figure6 <- ggarrange(shareRawls,moneyrawls,shareRawls2,moneyrawls2,
                    ncol = 2, nrow = 2)

shareRawlsBG <- ggplot(BGRawls, aes(x=decile))+
  geom_line(aes(y=Rawls),color="indianred2",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("EUR 12 tax as share of income (%)")+
  theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))

shareRawls2BG <- ggplot(BGRawls2, aes(x=decile))+
  geom_line(aes(y=Rawls2),color="deepskyblue3",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("EUR 34 tax as share of income (%)")+
  theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))




figure6BG <- ggarrange(shareRawlsBG,shareRawls2BG,
                    ncol = 1, nrow = 2)

abstract <- ggplot(data=BGRawls,aes(x=decile))+
  geom_line(aes(y=Rawls),color="deepskyblue3",size=1.2)+
  geom_line(data=BG_deciles,aes(x=decile,y=mean_tax1),color="indianred2",size=1.2)+
  geom_line(data=BG_deciles2,aes(x=decile,y=mean_lumptax1),color="lightpink3",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income decile")+
  ylab ("Average income share of the carbon tax (%)")+
  theme_calc()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="cornsilk"))+
  
abstractBG <- ggplot(data=BGRawls,aes(x=decile))+
  geom_line(aes(y=Rawls),color="deepskyblue3",size=1.2)+
  geom_line(data=BG_deciles,aes(x=decile,y=mean_tax1),color="indianred2",size=1.2)+
  geom_line(data=BG_deciles2,aes(x=decile,y=mean_lumptax1),color="lightpink3",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income deciles")+
  ylab ("Carbon tax as share of annual income (%)")+
  theme_stata()+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.01), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="white"))+
   annotate("label",x = 4.15, y=1.42,label=TeX(" Lump-sum redistribution"),size=5,fill="lightpink3",color="white", parse=TRUE)+
  annotate("label", size=5, x = 3.65, y=4.47,label=TeX(" Pre-redistribution"), fill="indianred2",color="white")+
   annotate("label", x = 4.15, y=-1,label=TeX("Rawlsian redistribution"),size=5,fill="deepskyblue3",color="white", parse=TRUE)

abstractRO <- ggplot(data=RORawls,aes(x=decile))+
  geom_line(aes(y=Rawls),color="deepskyblue3",size=1.2)+
  geom_line(data=RO_deciles,aes(x=decile,y=mean_tax1),color="indianred2",size=1.2)+
  geom_line(data=RO_deciles2,aes(x=decile,y=mean_lumptax1),color="lightpink3",size=1.2)+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  xlab("Income deciles")+
  ylab ("Carbon tax as share of annual income (%)")+
  theme_stata()+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))+
 theme(panel.background = element_rect(fill="white"))+
  theme(panel.grid.major = element_line(color="black",size=0.05, linetype="solid"),
  panel.grid.minor = element_line(color="black",size=0.01), axis.line = element_line(color="black"))+
   annotate("label", size=5,x = 2.85, y=1,label=TeX(" Lump-sum redistribution"),fill="lightpink3",color="white", parse=TRUE)+
  annotate("label", size=5,x = 3, y=2.57,label=TeX(" Pre-redistribution"), fill="indianred2",color="white")+
   annotate("label",size=5, x = 4.15, y=-1,label=TeX("Rawlsian redistribution"),fill="deepskyblue3",color="white", parse=TRUE)

abstract <- ggarrange(abstractRO,abstractBG,
                    ncol = 1, nrow = 2)
abstract

RO_descriptive <-RO %>% group_by(decile) %>% summarize(income=mean(income), co2=mean(sum))

ggplot(data=RO_descriptive, aes(x=decile,y=co2))+
geom_line(size=1.2, color="indianred2")+
scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))+
theme_stata()+
  ylab(TeX("Emissions level ($tCO_2$)"))+
  xlab("Income deciles")+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=15), axis.text.y=element_text(size=15), axis.title.y.left = element_text(size=15), axis.title.x.bottom = element_text(size=15))



BG_descriptive <-BG %>% group_by(decile) %>% summarize(income=mean(income), co2=mean(sum))

ggplot(data=BG_descriptive, aes(x=income,y=co2))+
geom_line(size=1.2, color="indianred2")+
scale_x_discrete(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  theme_calc()+
  ylab(TeX("Emissions level ($tCO_2$)"))+
  xlab("Income deciles")+
   theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=12), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=14), axis.title.x.bottom = element_text(size=14))+
  theme(panel.grid.major = element_line(color="cornsilk3",size=0.4, linetype="solid"),
  panel.grid.minor = element_line(color="cornsilk3",size=0.1), axis.line = element_line(color="black"))+
 theme(panel.background = element_rect(fill="cornsilk"))



RO_mixed <-RO %>% group_by(decile) %>% summarize(region=region,mean=mean(indicator1), min=min(indicator1), max=max(indicator1))

RO$decile <-as.factor(RO$decile)

RO %>% 
  ggplot(aes(x=factor(decile), y=share_tax1, fill=factor(region))) +
  geom_boxplot()+
  scale_x_discrete(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  theme_stata()+
  ylab("Average income share of the carbon tax (%)")+
  xlab("Income deciles")+
   geom_boxplot(outlier.shape = NA)+
  scale_y_continuous(limits = c(-0.5, 2.5)) +
  labs(fill="Region")+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=14), axis.text.y=element_text(size=14), axis.title.y.left = element_text(size=12), axis.title.x.bottom = element_text(size=14))


BG %>% 
  ggplot(aes(x=factor(decile), y=share_tax1, fill=factor(region))) +
  geom_boxplot()+
  scale_x_discrete(breaks=c(1,2,3,4,5,6,7,8,9,10))+
  theme_stata()+
  ylab("Average income share of the carbon tax (%)")+
  xlab("Income deciles")+
   geom_boxplot(outlier.shape = NA)+
  scale_y_continuous(limits = c(-0.5, 2.5)) +
  labs(fill="Region")+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=14), axis.text.y=element_text(size=14), axis.title.y.left = element_text(size=12), axis.title.x.bottom = element_text(size=14))

RO %>% 
  ggplot(aes(x=factor(decile), y=sum,fill=factor(decile))) +
  geom_boxplot()+
    theme_stata()+
  geom_boxplot(outlier.shape = NA)+
  scale_y_continuous(limits = c(-0.5, 10))+
   ylab("Average income share of the carbon tax (%)")+
  xlab("Income deciles")+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=14), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=12), axis.title.x.bottom = element_text(size=14))+
    theme(legend.position="none") +
  scale_fill_brewer(palette="BuPu")


BG%>% 
  ggplot(aes(x=factor(decile), y=sum,fill=factor(decile))) +
  geom_boxplot()+
    theme_stata()+
  geom_boxplot(outlier.shape = NA)+
  scale_y_continuous(limits = c(-0.5, 10))+
   ylab("Emissions level")+
  xlab("Income deciles")+
  theme(text=element_text(family="Baskerville"),axis.text.x = element_text(size=14), axis.text.y=element_text(size=12), axis.title.y.left = element_text(size=12), axis.title.x.bottom = element_text(size=14))+
    theme(legend.position="none") +
  scale_fill_brewer(palette="BuPu")
